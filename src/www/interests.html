<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choose Your Interests - newsPro</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="style.css">
    <script src="icons.js"></script>
    <script src="tags.js"></script>
    <style>
        .icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
        }
        .icon svg {
            width: 1em;
            height: 1em;
        }
        .interests-container {
            min-height: 100vh;
            background: #f5f3e7;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .interests-box {
            max-width: 800px;
            width: 100%;
            text-align: center;
        }
        .interests-header {
            margin-bottom: 2rem;
        }
        .interests-header h1 {
            font-size: 2.5rem;
            font-weight: 900;
            color: #000000;
            margin-bottom: 0.5rem;
            font-family: 'Arial Black', Arial, sans-serif;
            letter-spacing: 1px;
        }
        .interests-header p {
            font-size: 1rem;
            color: #666666;
            margin: 0;
            font-weight: 400;
        }
        .input-section {
            max-width: 700px;
            margin: 0 auto 2rem;
        }
        .input-container {
            background: #ffffff;
            border: 3px solid #000000;
            padding: 1.5rem;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
            margin-bottom: 1.5rem;
        }
        .input-label {
            display: block;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: #000000;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Arial Black', Arial, sans-serif;
        }
        .interest-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 2px solid #000000;
            font-size: 1rem;
            font-family: inherit;
            background: #ffffff;
            color: #000000;
            resize: vertical;
            transition: all 0.3s;
            line-height: 1.6;
        }
        .interest-textarea:focus {
            outline: none;
            border-color: #b22222;
            box-shadow: 0 0 0 3px rgba(178, 34, 34, 0.1);
        }
        .extract-button {
            background: #000000;
            color: #ffffff;
            border: 3px solid #000000;
            padding: 0.75rem 2rem;
            font-size: 0.9rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Arial Black', Arial, sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .extract-button:hover {
            background: #b22222;
            border-color: #b22222;
            transform: translateY(-2px);
            box-shadow: 6px 6px 0px rgba(0,0,0,0.3);
        }
        .extract-button:disabled {
            background: #cccccc;
            border-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .loading-spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: #ffffff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-right: 0.5rem;
        }
        .extract-button.loading .loading-spinner {
            display: inline-block;
        }
        .extract-button.loading {
            pointer-events: none;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .tags-section {
            max-width: 700px;
            margin: 0 auto 2rem;
        }
        .tags-label {
            font-weight: 700;
            margin-bottom: 1rem;
            color: #000000;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Arial Black', Arial, sans-serif;
        }
        .interest-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            margin-top: 1rem;
            min-height: 60px;
        }
        .interest-tag {
            padding: 0.5rem 1rem;
            background: #f5f3e7;
            border: 2px solid #000000;
            color: #000000;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Arial Black', Arial, sans-serif;
            font-size: 0.85rem;
        }
        .interest-tag.active {
            background: #b22222;
            color: #ffffff;
            border-color: #b22222;
        }
        .btn-add-interest {
            padding: 0.5rem 1rem;
            background: #ffffff;
            border: 2px dashed #000000;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            color: #000000;
            font-family: 'Arial Black', Arial, sans-serif;
            font-size: 0.85rem;
        }
        .btn-add-interest:hover {
            background: #f5f3e7;
        }
        .add-tag-input-container {
            display: none;
            gap: 0.5rem;
            align-items: center;
            margin-top: 0.75rem;
            flex-wrap: wrap;
        }
        .add-tag-input-container.active {
            display: flex;
        }
        .add-tag-input {
            flex: 1;
            min-width: 200px;
            padding: 0.5rem 1rem;
            border: 2px solid #000000;
            font-weight: 700;
            font-size: 0.9rem;
            font-family: 'Arial Black', Arial, sans-serif;
            background: #ffffff;
            color: #000000;
        }
        .add-tag-input:focus {
            outline: none;
            border-color: #b22222;
        }
        .btn-add-tag-confirm {
            padding: 0.5rem 1rem;
            background: #b22222;
            color: #ffffff;
            border: 2px solid #b22222;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Arial Black', Arial, sans-serif;
            font-size: 0.85rem;
        }
        .btn-add-tag-confirm:hover {
            background: #8b1a1a;
            border-color: #8b1a1a;
        }
        .btn-add-tag-cancel {
            padding: 0.5rem 1rem;
            background: #ffffff;
            color: #000000;
            border: 2px solid #000000;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Arial Black', Arial, sans-serif;
            font-size: 0.85rem;
        }
        .btn-add-tag-cancel:hover {
            background: #f5f3e7;
        }
        .empty-tags-message {
            color: #999999;
            font-style: italic;
            padding: 1rem;
            width: 100%;
        }
        .interests-footer {
            margin-top: 2rem;
        }
        .next-button {
            background: #b22222;
            color: #ffffff;
            border: 3px solid #b22222;
            padding: 1rem 4rem;
            font-size: 1rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Arial Black', Arial, sans-serif;
            border-radius: 8px;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
            min-width: 200px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .next-button:hover {
            background: #8b1a1a;
            transform: translateY(-2px);
            box-shadow: 6px 6px 0px rgba(0,0,0,0.3);
        }
        .next-button:disabled {
            background: #cccccc;
            border-color: #cccccc;
            color: #666666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .skip-link {
            display: inline-block;
            margin-top: 1.5rem;
            color: #666666;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .skip-link:hover {
            color: #000000;
            text-decoration: underline;
        }
        @media (max-width: 768px) {
            .interests-header h1 {
                font-size: 2rem;
            }
            .input-section,
            .tags-section {
                max-width: 100%;
                padding: 0 0.5rem;
            }
            .input-container {
                padding: 1rem;
            }
            .interest-textarea {
                min-height: 100px;
                font-size: 0.9rem;
            }
            .extract-button {
                width: 100%;
                padding: 0.75rem 1.5rem;
            }
            .tag-item {
                font-size: 0.8rem;
                padding: 0.4rem 0.75rem;
            }
            .next-button {
                padding: 0.9rem 3rem;
                font-size: 0.95rem;
                min-width: 180px;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="nav-left">
                <div class="logo" data-icon="news">newsPro</div>
            </div>
            <div class="user-actions">
                <a href="feed.html" class="btn btn-secondary">Skip</a>
            </div>
        </nav>
    </header>

    <div class="interests-container">
        <div class="interests-box">
            <div class="interests-header">
                <h1>Tell Us About Yourself</h1>
                <p>Describe your interests and we'll personalize your feed</p>
            </div>

            <div class="input-section">
                <div class="input-container">
                    <label for="interestInput" class="input-label">Your Interests & Background</label>
                    <textarea
                        id="interestInput"
                        class="interest-textarea"
                        placeholder="Example: I'm interested in AI trading algorithms, cryptocurrency markets, quantitative finance, and high-frequency trading. I work in fintech and follow blockchain technology closely..."
                    ></textarea>
                </div>
                <button class="extract-button" id="extractButton" onclick="extractTags()">
                    <span class="loading-spinner"></span>
                    <span class="button-text">Extract Tags</span>
                </button>
            </div>

            <div class="tags-section">
                <div class="tags-label">Your Interests</div>
                <p style="margin-bottom: 1rem; color: #666666; text-align: left;">Select topics you're interested in to personalize your feed</p>
                <div class="interest-tags" id="interestTags">
                    <div class="empty-tags-message">Enter your interests above and click "Extract Tags" to see your personalized tags, or add them manually</div>
                    <button class="btn-add-interest" id="addInterestBtn">+ Add More</button>
                </div>
                <div class="add-tag-input-container" id="addTagInputContainer">
                    <input type="text" class="add-tag-input" id="addTagInput" placeholder="Enter tag name..." maxlength="50">
                    <button class="btn-add-tag-confirm" id="confirmAddTag">Add</button>
                    <button class="btn-add-tag-cancel" id="cancelAddTag">Cancel</button>
                </div>
            </div>

            <div style="margin-top: 2rem; text-align: left;">
                <label style="display: block; font-weight: 700; margin-bottom: 0.5rem; color: #000000; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px;">Describe what interests you (AI will extract tags)</label>
                <textarea id="interestsPrompt" style="width: 100%; padding: 1rem; border: 2px solid #000000; font-family: inherit; font-size: 1rem; resize: vertical; min-height: 100px;" placeholder="e.g. I am interested in how AI is changing the financial landscape, specifically in high-frequency trading..."></textarea>
            </div>

            <div class="interests-footer">
                <button class="next-button" id="nextButton" onclick="handleNext()">
                    Next
                </button>
                <div>
                    <a href="feed.html" class="skip-link">Skip for now</a>
                </div>
            </div>
        </div>
    </div>

    <script>
        let extractedTags = [];

        document.addEventListener('DOMContentLoaded', function() {
            // Replace icons in logo
            if (typeof Icons !== 'undefined') {
                document.querySelectorAll('.logo[data-icon]').forEach(el => {
                    const iconName = el.getAttribute('data-icon');
                    if (Icons[iconName]) {
                        el.innerHTML = `<span class="icon">${Icons[iconName]}</span>${el.textContent.trim()}`;
                    }
                });
            }

            // Enable extract button when text is entered
            const textarea = document.getElementById('interestInput');
            const extractButton = document.getElementById('extractButton');

            extractButton.disabled = true;

            textarea.addEventListener('input', function() {
                if (this.value.trim().length > 0) {
                    extractButton.disabled = false;
                } else {
                    extractButton.disabled = true;
                }
            });

            // Initialize universal tag system
            TagsSystem.init(
                'interestTags',
                'addInterestBtn',
                'addTagInputContainer',
                'addTagInput',
                'confirmAddTag',
                'cancelAddTag'
            );

            // Enable Next button immediately (no longer depends on tags)
            updateNextButton();
        });

        function extractTags() {
            const input = document.getElementById('interestInput');
            const extractButton = document.getElementById('extractButton');
            const text = input.value.trim();

            if (!text) {
                return;
            }

            // Show loading state
            extractButton.classList.add('loading');
            extractButton.disabled = true;

            // Simulate processing time (in real app, this would be an API call)
            setTimeout(() => {
                // Simple tag extraction - in a real app, this would use NLP/AI
                const tags = extractTagsFromText(text);

                // Add extracted tags to the list (mark as active)
                const interestTags = document.getElementById('interestTags');
                const emptyMsg = interestTags.querySelector('.empty-tags-message');
                if (emptyMsg) {
                    emptyMsg.remove();
                }

                // Use universal tag system to add extracted tags
                TagsSystem.addExtractedTags(tags);
                updateNextButton();

                // Hide loading state
                extractButton.classList.remove('loading');
                extractButton.disabled = false;
            }, 800); // 800ms delay to show loading
        }

        function extractTagsFromText(text) {
            // Common finance/tech keywords to extract
            const keywords = [
                'ai', 'artificial intelligence', 'machine learning', 'ml',
                'trading', 'algorithm', 'algorithms', 'algorithmic trading',
                'cryptocurrency', 'crypto', 'bitcoin', 'blockchain',
                'quantitative finance', 'quant finance', 'quant',
                'market analysis', 'market', 'markets',
                'high frequency trading', 'hft', 'high-frequency',
                'investment banking', 'banking', 'investment',
                'venture capital', 'vc', 'venture',
                'startup', 'startups', 'entrepreneurship',
                'fintech', 'financial technology',
                'risk management', 'risk',
                'portfolio management', 'portfolio',
                'central bank', 'federal reserve', 'monetary policy',
                'global markets', 'international markets',
                'regulatory', 'compliance', 'regulation',
                'mergers', 'acquisitions', 'm&a', 'ma',
                'private equity', 'pe',
                'real estate', 'property',
                'commodities', 'commodity',
                'derivatives', 'options', 'futures',
                'insurance', 'underwriting'
            ];

            const lowerText = text.toLowerCase();
            const foundTags = [];
            const seen = new Set();

            // Extract keywords
            keywords.forEach(keyword => {
                if (lowerText.includes(keyword.toLowerCase()) && !seen.has(keyword)) {
                    // Format tag nicely
                    const formattedTag = keyword.split(' ')
                        .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                        .join(' ');
                    foundTags.push(formattedTag);
                    seen.add(keyword);
                }
            });

            // Also extract capitalized phrases (potential topics)
            const capitalizedPhrases = text.match(/\b[A-Z][a-z]+(?:\s+[A-Z][a-z]+)*\b/g);
            if (capitalizedPhrases) {
                capitalizedPhrases.forEach(phrase => {
                    if (phrase.length > 3 && phrase.length < 30 && !seen.has(phrase.toLowerCase())) {
                        foundTags.push(phrase);
                        seen.add(phrase.toLowerCase());
                    }
                });
            }

            // Limit to reasonable number
            return foundTags.slice(0, 15);
        }

        function displayTags(tags) {
            // This function is no longer needed - we add tags directly to the list
            // Keeping it for compatibility but it doesn't do anything
        }

        function updateNextButton() {
            // Button is always enabled now
            const nextButton = document.getElementById('nextButton');
            if (nextButton) {
                nextButton.disabled = false;
            }
        }

        function handleNext() {
            // Tags are already saved in localStorage by TagsSystem (even if empty)
            localStorage.setItem('interestsSelected', 'true');

            // Redirect to feed
            window.location.href = 'feed.html';
        }

    </script>
</body>
</html>

